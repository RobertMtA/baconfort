<!DOCTYPE html>
<html>
<head>
    <title>Test Gallery API - CORS Fixed</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .success { color: green; background: #e8f5e8; padding: 10px; margin: 10px 0; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 10px 0; }
        .info { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        img { max-width: 200px; max-height: 150px; margin: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>üß™ Test Gallery API - CORS FIXED</h1>
    <button onclick="testAPI()">üîÑ Test API Now</button>
    <div id="result"></div>

    <script>
        async function testAPI() {
            console.log('üß™ BROWSER TEST: Testing with CORS fix...');
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="info">üîÑ Testing API connection...</div>';
            
            try {
                console.log('üì§ BROWSER TEST: Calling API...');
                const response = await fetch('http://localhost:5000/api/gallery/moldes-1680', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    // No incluir credentials para evitar problemas
                    mode: 'cors'
                });

                console.log('üìä BROWSER TEST: Response received:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ BROWSER TEST: Data parsed:', data);
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <h2>‚úÖ API FUNCIONANDO!</h2>
                        <p><strong>Im√°genes encontradas:</strong> ${data.images?.length || 0}</p>
                        <p><strong>Status:</strong> ${data.success ? 'Success' : 'Failed'}</p>
                    </div>
                    
                    ${data.images?.length > 0 ? `
                        <div class="info">
                            <h3>üì∏ Primeras 3 im√°genes:</h3>
                            ${data.images.slice(0, 3).map((img, i) => `
                                <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
                                    <strong>${i + 1}. ${img.title}</strong><br>
                                    <small>URL: ${img.url}</small><br>
                                    <img src="${img.url}" alt="${img.title}" onerror="this.style.border='2px solid red'">
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <details style="margin-top: 20px;">
                        <summary>üîç Respuesta completa</summary>
                        <pre style="background: #f8f8f8; padding: 10px; overflow: auto; font-size: 12px;">
${JSON.stringify(data, null, 2)}
                        </pre>
                    </details>
                `;
                
            } catch (error) {
                console.error('‚ùå BROWSER TEST: Error:', error);
                resultDiv.innerHTML = `
                    <div class="error">
                        <h2>‚ùå API ERROR</h2>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Posibles causas:</strong></p>
                        <ul>
                            <li>Backend no est√° corriendo en puerto 5000</li>
                            <li>Problemas de CORS (aunque se configur√≥)</li>
                            <li>Firewall o antivirus bloqueando la conexi√≥n</li>
                            <li>Problema de red local</li>
                        </ul>
                    </div>
                `;
            }
        }

        // Auto-ejecutar al cargar
        window.addEventListener('load', () => {
            console.log('üîÑ BROWSER TEST: Auto-executing...');
            setTimeout(testAPI, 1000); // Esperar 1 segundo para asegurar que todo est√© cargado
        });
        
        // Tambi√©n ejecutar cada 5 segundos para ver si se resuelve
        setInterval(() => {
            if (document.querySelector('.error')) {
                console.log('üîÑ BROWSER TEST: Retry attempt...');
                testAPI();
            }
        }, 5000);
    </script>
</body>
</html>
