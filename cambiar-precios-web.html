<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiar Precios - BACONFORT Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .property-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .property-card {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .property-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #fff;
        }
        .price-group {
            margin-bottom: 15px;
        }
        .price-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .price-group input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }
        .update-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            width: 100%;
        }
        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .update-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }
        .status.success {
            background: rgba(40, 167, 69, 0.3);
            border: 1px solid rgba(40, 167, 69, 0.6);
        }
        .status.error {
            background: rgba(220, 53, 69, 0.3);
            border: 1px solid rgba(220, 53, 69, 0.6);
        }
        .global-actions {
            text-align: center;
            margin-bottom: 30px;
        }
        .global-btn {
            background: linear-gradient(45deg, #007bff, #6610f2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: all 0.3s;
        }
        .global-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .current-prices {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè† Cambiar Precios - BACONFORT Admin</h1>
        
        <div class="global-actions">
            <button class="global-btn" onclick="cargarPreciosActuales()">
                üîÑ Cargar Precios Actuales
            </button>
            <button class="global-btn" onclick="aplicarPreciosRecomendados()">
                ‚≠ê Aplicar Precios Recomendados
            </button>
            <button class="global-btn" onclick="actualizarTodo()">
                üíæ Actualizar Todo
            </button>
        </div>

        <div class="property-grid" id="propertyGrid">
            <!-- Las propiedades se cargar√°n din√°micamente -->
        </div>
    </div>

    <script>
        const API_URL = 'https://baconfort-backend.vercel.app/api';
        
        const propiedades = {
            'moldes-1680': {
                name: 'Moldes 1680 - Belgrano',
                current: { daily: 85, weekly: 350, monthly: 750 },
                recommended: { daily: 75, weekly: 330, monthly: 700 }
            },
            'santa-fe-3770': {
                name: 'Santa Fe 3770 - Palermo',
                current: { daily: 99, weekly: 299, monthly: 1000 },
                recommended: { daily: 80, weekly: 350, monthly: 750 }
            },
            'dorrego-1548': {
                name: 'Dorrego 1548 - Villa Crespo',
                current: { daily: 99, weekly: 299, monthly: 1000 },
                recommended: { daily: 70, weekly: 320, monthly: 680 }
            },
            'convencion-1994': {
                name: 'Convenci√≥n 1994 - Palermo Hollywood',
                current: { daily: 99, weekly: 299, monthly: 300 },
                recommended: { daily: 90, weekly: 380, monthly: 800 }
            },
            'ugarteche-2824': {
                name: 'Ugarteche 2824 - Palermo Bot√°nico',
                current: { daily: 99, weekly: 299, monthly: 350 },
                recommended: { daily: 95, weekly: 400, monthly: 850 }
            }
        };

        function createPropertyCard(id, property) {
            return `
                <div class="property-card">
                    <div class="property-title">${property.name}</div>
                    
                    <div class="current-prices">
                        <strong>Precios Actuales:</strong><br>
                        Diario: USD ${property.current.daily} | 
                        Semanal: USD ${property.current.weekly} | 
                        Mensual: USD ${property.current.monthly}
                    </div>
                    
                    <div class="price-group">
                        <label>üí∞ Precio Diario (USD):</label>
                        <input type="number" id="${id}-daily" value="${property.recommended.daily}" min="0">
                    </div>
                    
                    <div class="price-group">
                        <label>üìÖ Precio Semanal (USD):</label>
                        <input type="number" id="${id}-weekly" value="${property.recommended.weekly}" min="0">
                    </div>
                    
                    <div class="price-group">
                        <label>üìä Precio Mensual (USD):</label>
                        <input type="number" id="${id}-monthly" value="${property.recommended.monthly}" min="0">
                    </div>
                    
                    <button class="update-btn" onclick="actualizarPropiedad('${id}')">
                        üíæ Actualizar ${property.name}
                    </button>
                    
                    <div class="status" id="${id}-status" style="display: none;"></div>
                </div>
            `;
        }

        function renderProperties() {
            const grid = document.getElementById('propertyGrid');
            grid.innerHTML = Object.entries(propiedades)
                .map(([id, property]) => createPropertyCard(id, property))
                .join('');
        }

        async function actualizarPropiedad(id) {
            const dailyInput = document.getElementById(`${id}-daily`);
            const weeklyInput = document.getElementById(`${id}-weekly`);
            const monthlyInput = document.getElementById(`${id}-monthly`);
            const statusDiv = document.getElementById(`${id}-status`);
            const btn = event.target;

            btn.disabled = true;
            btn.textContent = '‚è≥ Actualizando...';

            try {
                const prices = {
                    daily: parseInt(dailyInput.value),
                    weekly: parseInt(weeklyInput.value),
                    monthly: parseInt(monthlyInput.value),
                    currency: 'USD'
                };

                const response = await fetch(`${API_URL}/properties/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ prices })
                });

                if (response.ok) {
                    const result = await response.json();
                    statusDiv.className = 'status success';
                    statusDiv.textContent = '‚úÖ Precios actualizados exitosamente!';
                    statusDiv.style.display = 'block';
                    
                    // Actualizar precios actuales
                    propiedades[id].current = prices;
                    
                    setTimeout(() => {
                        statusDiv.style.display = 'none';
                    }, 3000);
                } else {
                    throw new Error(`Error ${response.status}`);
                }

            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = `‚ùå Error: ${error.message}`;
                statusDiv.style.display = 'block';
            }

            btn.disabled = false;
            btn.textContent = `üíæ Actualizar ${propiedades[id].name}`;
        }

        async function cargarPreciosActuales() {
            console.log('üîÑ Cargando precios actuales...');
            
            for (const id of Object.keys(propiedades)) {
                try {
                    const response = await fetch(`${API_URL}/properties/${id}`);
                    if (response.ok) {
                        const result = await response.json();
                        const prices = result.data?.prices;
                        
                        if (prices) {
                            propiedades[id].current = {
                                daily: prices.daily || 0,
                                weekly: prices.weekly || 0,
                                monthly: prices.monthly || 0
                            };
                            
                            // Actualizar inputs
                            document.getElementById(`${id}-daily`).value = prices.daily || 0;
                            document.getElementById(`${id}-weekly`).value = prices.weekly || 0;
                            document.getElementById(`${id}-monthly`).value = prices.monthly || 0;
                        }
                    }
                } catch (error) {
                    console.error(`Error cargando ${id}:`, error);
                }
            }
            
            renderProperties();
            alert('‚úÖ Precios actuales cargados!');
        }

        async function aplicarPreciosRecomendados() {
            for (const id of Object.keys(propiedades)) {
                const recommended = propiedades[id].recommended;
                document.getElementById(`${id}-daily`).value = recommended.daily;
                document.getElementById(`${id}-weekly`).value = recommended.weekly;
                document.getElementById(`${id}-monthly`).value = recommended.monthly;
            }
            alert('‚≠ê Precios recomendados aplicados!');
        }

        async function actualizarTodo() {
            if (!confirm('¬øEst√°s seguro de actualizar TODAS las propiedades?')) {
                return;
            }

            for (const id of Object.keys(propiedades)) {
                try {
                    await actualizarPropiedad(id);
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    console.error(`Error actualizando ${id}:`, error);
                }
            }
            
            alert('‚úÖ Todas las propiedades actualizadas!');
        }

        // Inicializar
        renderProperties();
    </script>
</body>
</html>
