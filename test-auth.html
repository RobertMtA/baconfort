<!DOCTYPE html>
<html>
<head>
    <title>Test BACONFORT Auth</title>
</head>
<body>
    <h1>Test de Autenticaci√≥n BACONFORT</h1>
    
    <div>
        <h2>Limpiar Estado</h2>
        <button onclick="clearAuth()">Limpiar localStorage</button>
        <button onclick="checkAuth()">Verificar estado actual</button>
    </div>
    
    <div>
        <h2>Test Login Admin</h2>
        <button onclick="testAdminLogin()">Login como Admin</button>
    </div>
    
    <div>
        <h2>Test Login Guest</h2>
        <button onclick="testGuestLogin()">Login como Guest</button>
    </div>
    
    <div id="results" style="margin-top: 20px; padding: 10px; background: #f0f0f0;">
        <h3>Resultados:</h3>
        <pre id="output"></pre>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }
        
        function clearAuth() {
            localStorage.removeItem('baconfort-token');
            localStorage.removeItem('baconfort-user');
            log('‚úÖ localStorage limpiado');
        }
        
        function checkAuth() {
            const token = localStorage.getItem('baconfort-token');
            const user = localStorage.getItem('baconfort-user');
            
            log('üîç Estado actual:');
            log('  Token: ' + (token ? 'Presente' : 'No encontrado'));
            log('  Usuario: ' + (user ? JSON.stringify(JSON.parse(user), null, 2) : 'No encontrado'));
        }
        
        async function testAdminLogin() {
            try {
                log('üîê Intentando login admin...');
                
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'admin@baconfort.com',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Login exitoso!');
                    log('üë§ Usuario: ' + data.user.name);
                    log('üîë Rol: ' + data.user.role);
                    log('üìß Email: ' + data.user.email);
                    
                    // Guardar en localStorage
                    localStorage.setItem('baconfort-token', data.token);
                    localStorage.setItem('baconfort-user', JSON.stringify(data.user));
                    
                    log('üíæ Datos guardados en localStorage');
                } else {
                    log('‚ùå Error en login: ' + data.error);
                }
            } catch (error) {
                log('‚ùå Error: ' + error.message);
            }
        }
        
        async function testGuestLogin() {
            try {
                log('üîê Intentando login guest...');
                
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'guest@baconfort.com',
                        password: 'guest123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    log('‚úÖ Login exitoso!');
                    log('üë§ Usuario: ' + data.user.name);
                    log('üîë Rol: ' + data.user.role);
                    log('üìß Email: ' + data.user.email);
                    
                    // Guardar en localStorage
                    localStorage.setItem('baconfort-token', data.token);
                    localStorage.setItem('baconfort-user', JSON.stringify(data.user));
                    
                    log('üíæ Datos guardados en localStorage');
                } else {
                    log('‚ùå Error en login: ' + data.error);
                }
            } catch (error) {
                log('‚ùå Error: ' + error.message);
            }
        }
        
        // Verificar estado inicial
        checkAuth();
    </script>
</body>
</html>
